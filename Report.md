# Домашнее задание №4

Описание/Пошаговая инструкция выполнения домашнего задания:

* 1 Создайте новый кластер PostgresSQL 14
  > <img src="pic/1.JPG" align="center" />
* 2 Зайдите в созданный кластер под пользователем postgres
sudo -u postgres psql
* 3 Создайте новую базу данных testdb
  > <img src="pic/3.JPG" align="center" />
* 4 Зайдите в созданную базу данных под пользователем postgres
  > <img src="pic/4.JPG" align="center" />
* 5 Создайте новую схему testnm
  > <img src="pic/5.JPG" align="center" />
* 6 Создайте новую таблицу t1 с одной колонкой c1 типа integer
  > <img src="pic/6.JPG" align="center" />
* 7 Вставьте строку со значением c1=1
  > <img src="pic/7.JPG" align="center" />
* 8 Создайте новую роль readonly
  > <img src="pic/8.JPG" align="center" />
* 9 Дайте новой роли право на подключение к базе данных testdb
  > <img src="pic/9.JPG" align="center" />
* 10 Дайте новой роли право на использование схемы testnm 
  > <img src="pic/10.JPG" align="center" />
* 11 Дайте новой роли право на select для всех таблиц схемы testnm 
  > <img src="pic/11.JPG" align="center" />
* 12 Создайте пользователя testread с паролем test123 
  > <img src="pic/12.JPG" align="center" />
* 13 Дайте роль readonly пользователю testread 
  > <img src="pic/13.JPG" align="center" />
* 14 Зайдите под пользователем testread в базу данных testdb
  > <img src="pic/14.JPG" align="center" />
* 15 Сделайте select * from t1;
  > <img src="pic/15.JPG" align="center" />
* 16 Получилось? (могло если вы делали сами не по шпаргалке и не упустили один существенный момент про который позже)
<br> __*Не получилось прочитать таблицу t1, нет прав доступа.*__
  > <img src="pic/16.JPG" align="center" />
* 17 Напишите что именно произошло в тексте домашнего задания
<br> __*Создали таблицу t1 в базе данных testdb, и у пользователя testread  есть доступ к базе testdb из-за роли readonly. Казалось бы что пользователь testread должен иметь доступ на чтение к ней, а доступа нет.  В задании сказано было создать таблицу t1, но не указали в какой схеме.*__
* 18 У вас есть идеи почему? ведь права то дали?
<br> __*Потому что права на testnm для роли readonly дали, а права на public для роли readonly не дали. А таблица создана как раз в  схеме public.*__
* 19 Посмотрите на список таблиц
  > <img src="pic/19.JPG" align="center" />
* 20 Подсказка в шпаргалке под пунктом 20
* 21 А почему так получилось с таблицей (если делали сами и без шпаргалки то может у вас все нормально)
<br> __*Потому что при создании таблицы t1 не была указана явно схема testnm, в которой создать. Поэтому таблица создалась по умолчанию в схеме public. 
Прав на public для роли readonly не давали.*__
* 22 Вернитесь в базу данных testdb под пользователем postgres
  > <img src="pic/22.JPG" align="center" />
* 23 Удалите таблицу t1
  > <img src="pic/23.JPG" align="center" />
* 24 Создайте ее заново но уже с явным указанием имени схемы testnm
  > <img src="pic/24.JPG" align="center" />
* 25 Вставьте строку со значением c1=1
  > <img src="pic/25.JPG" align="center" />
* 26 Зайдите под пользователем testread в базу данных testdb
  > <img src="pic/26.JPG" align="center" />
* 27 Сделайте select * from testnm.t1;
  > <img src="pic/27.JPG" align="center" />
* 28 Получилось?
<br> __*Нет, не получилось, нет прав доступа.*__
* 29 Есть идеи почему? если нет - смотрите шпаргалку
<br> __*Потому что выполненная ранее команда «grant SELECT on all TABLEs in SCHEMA testnm TO readonly;» была актуальна для существующих таблиц на тот момент. 
С момента ее выполнения таблица пересоздавалась, и теперь нужно повторно выполнить команду «grant SELECT on all TABLEs in SCHEMA testnm TO readonly;»*__

<br> __*Потому что команда «ALTER default…» будет действовать для новых таблиц, а команда «grant SELECT on all TABLEs in SCHEMA testnm TO readonly» отработала только для существующих таблиц на тот момент времени. Нужно выполнить снова  команду «grant SELECT…» или пересоздать таблицу.*__
* 30 Как сделать так чтобы такое больше не повторялось? если нет идей - смотрите шпаргалку
  > <img src="pic/30.JPG" align="center" />
* 31 Сделайте select * from testnm.t1;
  > <img src="pic/31.JPG" align="center" />
* 32 Получилось?
<br> __*Да.*__
  > <img src="pic/32.JPG" align="center" />
* 33 Ура!
* 34 Теперь попробуйте выполнить команду create table t2(c1 integer); insert into t2 values (2);
  > <img src="pic/34.JPG" align="center" />
* 35 А как так? нам же никто прав на создание таблиц и insert в них под ролью readonly?
<br> __*Таблица создалась в схеме public, по умолчанию, так как не указал явно схему при создании таблицы.*__ 
<br> __*Каждый пользователь может по умолчанию создавать объекты в схеме public в базе данных, если у него есть право на подключение к этой базе данных.
А право на подключение к базе testdb у пользователя testread есть.*__
* 36 Есть идеи как убрать эти права? если нет - смотрите шпаргалку
<br> __*Нужно отменить права на создание таблиц в схеме public для пользователя testread.*__
* 37 Если вы справились сами то расскажите что сделали и почему, если смотрели шпаргалку - объясните что сделали и почему выполнив указанные в ней команды
<br> __*Под суперпользователем postgres запретил создавать таблицы в схеме public в базе testdb.*__
<br> __*Команда «REVOKE CREATE on SCHEMA public FROM public; » отменила права на создание чего либо в схеме public  всем пользователям.*__
<br> __*Команда « REVOKE ALL on DATABASE testdb FROM public; » отменила всем все права по отношению к базе данных  testdb.*__
  > <img src="pic/37.JPG" align="center" />
* 38 Теперь попробуйте выполнить команду create table t3(c1 integer); insert into t2 values (2);
  > <img src="pic/38.JPG" align="center" />
* 39 Расскажите что получилось и почему
<br> __*Теперь создать таблицу в БД testdb не получилось. Права на создание таблиц в схеме  public отменены.*__ 

